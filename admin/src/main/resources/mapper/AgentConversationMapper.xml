<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nageoffer.shortlink.admin.dao.mapper.AgentConversationMapper">

    <resultMap id="BaseResultMap" type="com.nageoffer.shortlink.admin.dao.entity.AgentConversation">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="sessionId" column="session_id" jdbcType="VARCHAR"/>
        <result property="userId" column="user_id" jdbcType="VARCHAR"/>
        <result property="agentId" column="agent_id" jdbcType="BIGINT"/>
        <result property="conversationTitle" column="conversation_title" jdbcType="VARCHAR"/>
        <result property="messageCount" column="message_count" jdbcType="INTEGER"/>
        <result property="totalTokens" column="total_tokens" jdbcType="INTEGER"/>
        <result property="status" column="status" jdbcType="TINYINT"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
        <result property="delFlag" column="del_flag" jdbcType="TINYINT"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, session_id, user_id, agent_id, conversation_title, message_count, total_tokens, status, create_time, update_time, del_flag
    </sql>

    <select id="selectConversationPage" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM agent_conversation
        WHERE user_id = #{userId}
        AND del_flag = 0
        <if test="agentId != null">
            AND agent_id = #{agentId}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
        <if test="keyword != null and keyword != ''">
            AND conversation_title LIKE CONCAT('%', #{keyword}, '%')
        </if>
        ORDER BY update_time DESC
    </select>

</mapper>